# killemall
A simple server for accessing and writing encrypted data only if the title is known.

> :warning: Right now there is no support for https and JWT token expiration. I will add both tomorrow (29/3/2020).

## How it works
Killemall works by encrypting (AES256) the body of each entry with its original title, and instead of storing the original title in the database - storing the hash (BCrypt) of it. Thus, an entry can be accessed only if the title is already known, and the titles themselves cannot be listed (they are hashed).

## Setup
First, clone this repository. Rename `config.json.example` to `config.json` and edit it like so:
The `"salt"` property is the salt used to store titles. It can be generated by running
```javascript
require("bcrypt").genSalt(8, (err, salt) => console.log(salt));
```
in an initialized npm package with `bcrypt` installed; or by using [https://asecuritysite.com/encryption/bcrypt](https://asecuritysite.com/encryption/bcrypt).

Each hash in `keys` can be generated using
```javascript
bcrypt.hash("the_key_i_want", "some_salt_i_generated", (err, hash) => console.log(hash));
```
or with [https://bcrypt-generator.com/](https://bcrypt-generator.com/).

You can set the roles you want for each key.

You need to specify a random `secret` under `"secret"`.

As for the database, you need to use MySQL, make a new database (and a user identified with a native MySQL password) and fill the appropriate data under `"db"`. Create a new table using
```sql
CREATE TABLE entries(
  title BINARY(60) NOT NULL UNIQUE,
  body BLOB(65535),
  PRIMARY KEY(title)
);
```
Now you can run the server using `node src/index.js`.
## Usage with cURL
### Getting a token
Killemall uses JWT, so in order to get a token with cURL you need to run the following command:
```bash
curl -X POST -H "Content-Type: application/json" --data '{"key":"my_key"}' http://localhost:5120/conn
```
### Setting an entry
```bash
curl -X POST -H "Content-Type: application/json" -H "Authorization: Bearer <my_token>" http://localhost:5120/set --data  '{"title":"<entry_title>","body":"<entry_body>"}'
```
### Getting an entry
```bash
curl -X POST -H "Content-Type: application/json" -H "Authorization: Bearer <my_token>" http://localhost:5120/get --data '{"title":"<entry_title>"}'
```
## A Few More Things
 - This project is a hobby, so it might have security leaks which I'm unaware of.
 - Killemall uses port 5120 by defualt, you can change it by setting the `PORT` enviroment variable.
 - Yes, "Killemall" and 5120 is a reference to Metallica.
